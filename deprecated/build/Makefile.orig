#
# Makefile
#
APPNAME=hcron
VERSION=0.8
PLATFORM=all
OVERLAY=""
FQAPPNAME=$(APPNAME)_$(VERSION)_$(PLATFORM)
FQAPPOVERLAYNAME=$(FQAPPNAME)$(OVERLAY)

DISTHOME=$(HOME)/tmp2/$(FQAPPOVERLAYNAME)/$(FQAPPNAME)

DEBIAN=DEBIAN/control \
    DEBIAN/postinst \
    DEBIAN/prerm

USR=usr/
#USR=

BIN=$(USR)bin/hcron-conv \
    $(USR)bin/hcron-event \
    $(USR)bin/hcron-fqdn \
    $(USR)bin/hcron-reload

ETC=etc/$(APPNAME)/hcron.conf.sample \
    etc/init.d/$(APPNAME)

LIB=$(USR)lib/python/hcron-conv.py \
    $(USR)lib/python/hcron-event.py \
    $(USR)lib/python/hcron-fqdn.py \
    $(USR)lib/python/hcron-reload.py \
    $(USR)lib/python/hcron-scheduler.py \
    $(USR)lib/python/$(APPNAME)/__init__.py \
    $(USR)lib/python/$(APPNAME)/constants.py \
    $(USR)lib/python/$(APPNAME)/execute.py \
    $(USR)lib/python/$(APPNAME)/event.py \
    $(USR)lib/python/$(APPNAME)/file.py \
    $(USR)lib/python/$(APPNAME)/globals.py \
    $(USR)lib/python/$(APPNAME)/library.py \
    $(USR)lib/python/$(APPNAME)/logger.py \
    $(USR)lib/python/$(APPNAME)/notify.py \
    $(USR)lib/python/$(APPNAME)/server.py \
    $(USR)lib/python/$(APPNAME)/safeeval.py \
   
SBIN=$(USR)sbin/hcron-scheduler

SHARE=$(USR)share/$(APPNAME)/COPYING \
    $(USR)share/man/man1/hcron-conv.1 \
    $(USR)share/man/man1/hcron-event.1 \
    $(USR)share/man/man1/hcron-fqdn.1 \
    $(USR)share/man/man1/hcron-reload.1 \
    $(USR)share/man/man7/hcron.7 \
    $(USR)share/man/man8/hcron-scheduler.8

SSM=.ssm.d/control \
    .ssm.d/compilepys.sh

VAR=var/lib/$(APPNAME) \
    var/log/$(APPNAME) \
    var/spool/$(APPNAME)

nothing:

#deb: $(DEBIAN) $(BIN) $(ETC) $(LIB) $(SBIN) $(VAR)
deb: $(DEBIAN) $(BIN) $(LIB) $(SBIN) $(VAR)
	mkdir -p $(DISTHOME) \
	    $(DISTHOME)/DEBIAN \
 	    $(DISTHOME)/etc/$(APPNAME) \
            $(DISTHOME)/usr/bin \
            $(DISTHOME)/usr/lib/python/$(APPNAME) \
            $(DISTHOME)/usr/sbin \
            $(DISTHOME)/usr/share/$(APPNAME) \
            $(DISTHOME)/var/lib/$(APPNAME) \
            $(DISTHOME)/var/log/$(APPNAME) \
            $(DISTHOME)/var/spool/$(APPNAME)
	tar cvf - $(DEBIAN) $(BIN) $(ETC) $(LIB) $(SBIN) $(SHARE) $(VAR) | (cd $(DISTHOME); tar xvf -)
	for f in $(DEBIAN) $(BIN) $(ETC) $(LIB) $(SBIN) $(SHARE) $(VAR) ; do \
	 chmod 755 "$(DISTHOME)/$$f" ; \
	done
	(cd $(DISTHOME)/..; fakeroot -- dpkg-deb --build $(FQAPPNAME) $(APPNAME)_$(VERSION)_all.deb; \
	echo ""; echo "**************************************************"; \
	echo "The $(FQAPPOVERLAYNAME) distribution file is at `pwd` ."; \
	echo "**************************************************" )

dist: $(BIN) $(ETC) $(LIB) $(SBIN) $(SSM) $(VAR)
	mkdir -p $(DISTHOME) \
            $(DISTHOME)/.ssm \
            $(DISTHOME)/bin \
            $(DISTHOME)/etc/$(APPNAME) \
            $(DISTHOME)/lib/python/$(APPNAME) \
            $(DISTHOME)/sbin \
            $(DISTHOME)/var/log
	tar cvf - $(BIN) $(ETC) $(LIB) $(SBIN) $(SHARE) $(SSM) $(VAR) | (cd $(DISTHOME); tar xvf -)
	for f in $(BIN) $(ETC) $(LIB) $(SBIN) $(SHARE) $(SSM) $(VAR); do \
	 chmod 755 "$(DISTHOME)/$$f" ; \
	done
	(cd $(DISTHOME); tar cvfz ../$(FQAPPOVERLAYNAME).tgz *; \
	echo ""; echo "**************************************************"; \
	echo "The $(FQAPPOVERLAYNAME) distribution file is at `pwd` ."; \
	echo "**************************************************" )
